# 프로세스 관리

## 1. 프로세스와 서비스

### I. 프로세스

- 프로세스란?
  - 메인 메모리에 프로그램이 올라가 기능을 수행할 수 있는 작업 단위

- 리눅스 시스템을 구동하기 위해 가장 먼저 활동하는 것은 시작 프로세스
- 리눅스 계열 운영체제에서 구동되는 시작 프로세스는 Unix식 시동 프로세스와 여러모로 유사한 점이 많음



### II.  프로세스 상태

- 커널은 준비 큐, 대기 큐, 실행 큐 등의 자료구조를 이용하여 프로세스 상태를 관리

#### 1) 프로세스 관리

1. 생성
   - 프로세스가 생성되는 중
2. 실행
   - 프로세스가 cpu를 차지하여 명령어들이 실행되는 상태
3. 준비(ready)
   - 프로세스가 CPU를 사용하고 있지는 않지만 다른 모든 자원을 할당받아 언제든지 사용할 수 있는 상태로, CPU가 할당되기를 기다리는 상태
4. 대기(waiting) == 보류(blocked)
   - 할당받은 CPU를 반납하고 특정 리소스나 입출력 이벤트를 기다리는 상태
5. 종료
   - 프로세스의 실행이 종료되는 상태



### III. 프로세스 상태 전이

- 하나의 프로그램이 실행되면 그 프로그램에 대응되는 프로세스가 생성되어 준비 리스트의 끝에 들어감
- 준비 리스트 상의 다른 프로세스들이 CPU를 할당받아 준비 리스트를 벗어나면 그 프로세스는 점차 준비 리스트의 앞으로 나가게 되고 할당된 순서가 도래되면 CPU를 사용하게 됨
- 이와 같은 과정을 프로세스 상태 전이라고 함

- 디스패치
  - 준비 리스트의 맨 앞에 있던 프로세스가 CPU를 점유하게 되는 것
  - 준비(ready) => 실행(running)
- 보류(block)
  - 실행 상태의 프로세스가 허가된 시간을 다 쓰기 전에 입출력 동작을 필요로 하는 경우 프로세스는 CPU를 스스로 반납하고 보류 상태로 넘어가는 과정
  - running => blocked
- 깨움
  - 기다리던 이벤트가 일어났을 때, 보류 상태에서 준비 상태로 넘어가는 것
  - blocked => ready
- 시간제한
  - 운영체제는 프로세스가 프로세서를 계속 독점해서 사용하지 못하게 시분할 시스템을 이용해 일정 시간동안만 프로세스를 점유할 수 있게 하며 다음과 같이 단계를 이동
  - running => ready



### IV. 프로세스의 종류

#### 1) 포그라운드 프로세스

- 화면에서 프로그램이 실행되는 것을 눈으로 확인할 수 있는 상태의 프로세스
- 즉, 사용자와 상호작용을 통해 작업을 수행할 수 있게 해 주는 프로세스
- 예시
  - 윈도우 상태표시줄 상의 프로그램들

#### 2) 백그라운드 프로세스

- 눈에 보이지는 않지만 실행중인 프로세스
- 예시
  - 백신 프로그램, 서버 데몬



### V. 프로세스 관련 용어

#### 1) 프로세스 번호

- CPU가 프로세스를 구별하기 위해 부여되는 고유번호
- PID(Processor ID)라고 함
- 프로세스 스케쥴러에 의해 우선적으로 처리해야 할 프로세스의 순서가 결정됨
  - 프로세스의 상태 전이가 발생하게 되는 이유

#### 2) 작업 번호 

- 현재 실행되는 백그라운드 프로세스가 CPU를 점유하여 작업을 수행할 때의 순차번호

#### 3) 부모 프로세스와 자식 프로세스

- 프로그램 중에서는 독립적으로 구동되는 것이 아니라, 종속적으로 구동되는 프로그램들이 있음
- 처음 실행한 프로그램의 메뉴에서 종속된 프로그램을 실행하게 되면 두 개의 프로세스가 구동되게 되는데, 이때 처음 실행한 프로그램을 부모 프로세스, 종속되어 실행된 프로세스를 자식 프로세스라고 함
- 부모 프로세스의 PID를 PPID(Parents Processor ID)라고 함

- 부모 프로세스가 종료되면 자식 프로세스 또한 강제로 종료됨
- 부모 프로세스와 자식 프로세스 간 관계는 여러 단계로 이루어질 수 있음

#### 4) 좀비 프로세스

- 자식 프로세스 종료 되었음에도 PCB 목록에 남아있어 메모리를 차지하고 있을 때, 이를 좀비 프로세스라고 함

- 자식 프로세스가 종료되지 않고 부모 프로세스 먼저 종료되어 부모 프로세스가 자식 프로세스 종료 처리를 해주지 못했을 경우에 발생

  



###  VI. ps: 프로세스 상태 확인 명령어

#### 1) ps명령

![image-20230112143928329](C:\Users\User\Desktop\Linux\프로세스_관리.assets\image-20230112143928329.png)

- **p**rocess **s**tatus

- 보통은 `$ ps -ef`를 많이 쓴다.

  - 예시
    - 프로세스 중 ssh와 관련된 프로세스 출력
      - `$ ps -ef | grep ssh`

- 옵션 설명

  - e
    - 
  - f
    - 프로세스 상세 정보 출력
  - `-p PID === --pid PID=== p PID`
    - PID를 가진 프로세스의 정보 출력

  - `--ppid PID`
    - 부모 프로세슬로 PID를 가진 프로세스의 정보 출력
  - `-a` === `-x`

#### 2) `$ ps -aux` 출력 결과를 통한 출력 항목 알아보기

- STAT
  - `+` 포그라운드 프로세스 그룹
    - 얘만 알면 된다.
  - R, S, D, T, Z

![image-20230112143555133](C:\Users\User\Desktop\Linux\프로세스_관리.assets\image-20230112143555133.png)

![image-20230112143617045](C:\Users\User\Desktop\Linux\프로세스_관리.assets\image-20230112143617045.png)



- ppid 검색
- `$ ps -f --ppid 번호`
  - 번호 프로세스를 부모 프로세스로 가진 프로세스들 상세 출력



- `$ pgrep [옵션] [패턴]`
  - 보통 이거 안쓰고 ps로 쓴다.



### kill 명령: 프로세스 종료

- kill [시그널] IPD

- 시그널(일종의 옵션)
  - `-2`
    - 컨트롤 c
  - `-9` 
    - 강제종료
  - `-15`
    - 정상종료



## 서비스와 소켓

- 최중요 부분
- 서비스는 데몬(Daemon)이라고도 하며 서버 프로세스를 의미
- 서버 프로세스는 네임 서버, 웹 서버, DB 서버 등의 프로세스라고 표현
  - 네임 서버 데몬, 웹 서버 데몬, DB 서버 데몬으로 표현하기도 함
- 백그라운드 프로세스의 일종
- systemctl 명령
- 리눅스 시스템에서 제공하고 있는 서비스의 스크립트 종류 살펴보기
  - `# cd /usr/lib/`



- 소켓

  - 서비스 또는 데몬은 필요여부를 떠나 항상 가동하고 있는 서버 프로세스를 의미하는 반면 소켓은 필요할 때만 작동하는 서버 프로세스를 의미

  - 외부에서 특정 서비스 요청이 들어올 경우 systemd 서비스가 소켓을 구동시키고, 요청이 끝나면 소켓이 종료

  - systemd

    - 서비스 매니저 프로그램

    - 기존 유닉스의 init(전체 프로세스 관리하던 놈) 프로세스가 수행하던 작업을 대신 수행

    - ststemd 서비스 유닛의 종류

      - service
        - 중요!
      - snapshot
        - 다른 유닛을 참조

    - 특징 => 중요

      - 서비스에 시그널 전달
      - fsck와 마운트 제어 가능
      - 스냅샷 유지

    - systemctl

      - ststemd 관련 명령

      - 사용 안하는 명령

        - is-active, is-enable, isolate
        - 나머지는 사용

        

